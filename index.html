<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weekly Planner</title>
  <style>
    /* THEME TOKENS */
    :root{
      /* dark (blue/black) */
      --bg: #0f172a;
      --panel: #111827;
      --card: #0b1220;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --accent: #4f46e5;
      --accent-2: #22c55e;
      --danger: #ef4444;
      --ring: #7c3aed33;
      --border: #ffffff1a;
      --task-bg: #0b1020;
      --link: #a5b4fc;
      --gradient-a: #1f2937;
      --gradient-b: #0b1020;
      --gradient-c: #05070c;
      --button-grad-a: #6366f1;
      --button-grad-b: #4f46e5;
      --input-bg: #0b1020;
      --input-border: #ffffff1f;
      --header-sep: #ffffff15;
    }

    [data-theme="light"]{
      --bg: #f4f4f5;
      --panel: #ffffff;
      --card: #fafafa;
      --text: #111827;
      --muted: #6b7280;
      --accent: #52525b;
      --accent-2: #16a34a;
      --danger: #dc2626;
      --ring: #6b728033;
      --border: #e5e7eb;
      --task-bg: #ffffff;
      --link: #2563eb;
      --gradient-a: #ffffff;
      --gradient-b: #ffffff;
      --gradient-c: #f4f4f5;
      --button-grad-a: #9ca3af;
      --button-grad-b: #6b7280;
      --input-bg: #ffffff;
      --input-border: #e5e7eb;
      --header-sep: #e5e7eb;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 800px at 50% -20%, var(--gradient-a), var(--gradient-b) 65%, var(--gradient-c) 100%), var(--bg);
      color:var(--text);
      display:flex; flex-direction:column;
    }

    header{ position:sticky; top:0; z-index:5; backdrop-filter:saturate(140%) blur(6px);
      background: linear-gradient(180deg, color-mix(in hsl, var(--bg), transparent 15%), color-mix(in hsl, var(--bg), transparent 45%), transparent);
      border-bottom: 1px solid var(--header-sep); text-align:center; padding:24px 16px 10px; }
    header h1{ margin:0; font-size: clamp(20px, 2.4vw, 28px); font-weight:700; letter-spacing:.3px }
    header .sub{ margin-top:6px; font-size:13px; color:var(--muted) }

    .topbar{ display:flex; justify-content:center; gap:16px; align-items:center; margin-top:10px; }
    .theme-toggle{ display:inline-flex; align-items:center; gap:10px; font-size:12px; color:var(--muted); }
    .switch{ position:relative; width:48px; height:26px; }
    .switch input{ opacity:0; width:0; height:0 }
    .slider{ position:absolute; inset:0; border-radius:999px; background:var(--border); transition:background .2s }
    .slider::before{ content:""; position:absolute; height:20px; width:20px; left:3px; top:3px; border-radius:50%; background:var(--panel); border:1px solid var(--border); transition: transform .2s }
    .switch input:checked + .slider{ background: color-mix(in hsl, var(--accent), white 60%) }
    .switch input:checked + .slider::before{ transform: translateX(22px) }

    .shell{ width:min(1200px, 96%); margin:18px auto 28px; }

    .composer{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; background:linear-gradient(180deg, var(--panel), var(--card));
      border:1px solid var(--border); border-radius:14px; padding:12px; box-shadow: 0 8px 30px #00000020; }
    .composer input[type="text"], .composer select{ flex:1 1 220px; padding:12px 14px; border-radius:10px; border:1px solid var(--input-border); background:var(--input-bg); color:var(--text);
      outline:none; transition:border-color .15s, box-shadow .15s; }
    .composer input[type="text"]:focus, .composer select:focus{ border-color:var(--accent); box-shadow:0 0 0 4px var(--ring) }
    .composer button{ padding:12px 16px; border-radius:12px; background:linear-gradient(180deg, var(--button-grad-a), var(--button-grad-b)); color:#fff; border:none; font-weight:700; cursor:pointer;
      transition: transform .05s ease, filter .2s ease; white-space:nowrap; }
    .composer button:active{ transform: translateY(1px) }

    .board{ margin-top:18px; }
    .columns{ display:grid; gap:12px; align-items:start; justify-items:stretch; grid-template-columns: repeat(4, minmax(220px, 1fr)); }
    @media (min-width:1100px){ .columns{ grid-template-columns: repeat(7, 1fr); } }
    @media (max-width:900px){ .columns{ grid-template-columns: repeat(2, minmax(220px, 1fr)); } }
    @media (max-width:620px){ .columns{ grid-template-columns: 1fr; } }

    .column{ background:linear-gradient(180deg, var(--panel), var(--card)); padding:10px; border-radius:14px; border:1px solid var(--border);
      min-height:220px; box-shadow: 0 8px 24px #00000025; }
    .col-head{ display:flex; justify-content:space-between; align-items:center; margin:4px 4px 8px; }
    .col-head h3{ margin:0; font-size:14px; letter-spacing:.6px; text-transform:uppercase; color:var(--muted) }
    .badge{ font-size:12px; color:var(--muted); background:color-mix(in hsl, var(--border), var(--panel) 30%); padding:4px 8px; border-radius:999px }

    .list{ list-style:none; margin:0; padding:6px; border:1px dashed var(--border); border-radius:12px; min-height:160px; transition: background .15s ease }
    .list.drag-over{ background:color-mix(in hsl, var(--accent), transparent 85%) }

    .task{ transition: transform .15s ease, box-shadow .15s ease; display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px; background:var(--task-bg); border:1px solid var(--border); margin:8px 0; cursor:grab; user-select:none; }
    .task.dragging{ opacity:0.6; transform:scale(1.05); box-shadow:0 8px 20px #00000055; }

    .icon-btn{ border:none; background:color-mix(in hsl, var(--border), var(--panel) 30%); color:var(--text); border-radius:10px; padding:8px; cursor:pointer; display:inline-flex; align-items:center; justify-content:center; }
    .icon-btn.danger{ background: color-mix(in hsl, var(--danger), white 85%) }
    .icon-btn.success{ background: color-mix(in hsl, var(--accent-2), white 80%) }

    .hint{ margin:12px 2px 0; color:var(--muted); font-size:12px }
    .future-row{ margin-top:12px; }
  </style>
</head>
<body>
  <header>
    <h1 id="today"></h1>
    <div class="sub" id="weekRange"></div>
    <div class="topbar">
      <div class="theme-toggle">
        <span>Dark</span>
        <label class="switch" aria-label="Toggle light theme">
          <input id="themeToggle" type="checkbox" />
          <span class="slider"></span>
        </label>
        <span>Light</span>
      </div>
    </div>
  </header>

  <div class="shell">
    <section class="composer" aria-labelledby="addTaskLabel">
      <label id="addTaskLabel" class="pill" for="taskText">Add a task</label>
      <input id="taskText" type="text" placeholder="New task..." />
      <select id="taskDay"></select>
      <button id="addBtn" type="button">Add</button>
    </section>

    <section class="board">
      <div id="columns" class="columns"></div>
      <div id="futureRow" class="future-row"></div>
      <p class="hint">Tip: drag tasks between days (or into <strong>Future Tasks</strong>).</p>
    </section>
  </div>

  <script>
  (function(){
    const DAYS=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
    const FUTURE="Future Tasks";
    const STORAGE_KEY="weekly_planner_v1"; // tasks + week key
    const THEME_KEY="planner_theme";       // theme only

    const $=(s,r=document)=>r.querySelector(s);
    const uid=()=>Math.random().toString(36).slice(2)+Date.now().toString(36);

    /** Date header **/
    function renderHeader(){
      const now=new Date();
      const start=weekStart(now); const end=new Date(start); end.setDate(start.getDate()+6);
      const heading=now.toLocaleDateString(undefined,{weekday:'long',year:'numeric',month:'long',day:'numeric'});
      const fmt=(d)=>d.toLocaleDateString(undefined,{month:'short',day:'numeric'});
      const range=`${fmt(start)} â€“ ${fmt(end)}`;
      const todayEl=$('#today'); if(todayEl) todayEl.textContent=heading;
      const rangeEl=$('#weekRange'); if(rangeEl) rangeEl.textContent=range;
    }

    /** Week helpers **/
    function weekStart(d){ const x=new Date(d); x.setHours(0,0,0,0); x.setDate(x.getDate()-x.getDay()); return x; } // Sunday start
    function weekKeyFor(d){ const s=weekStart(d); return `${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,'0')}-${String(s.getDate()).padStart(2,'0')}`; }

    /** State **/
    function blankState(){ const o={ __weekKey: weekKeyFor(new Date()) }; for(const day of DAYS) o[day]=[]; o[FUTURE]=[]; return o; }
    function load(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY))||blankState(); }catch{return blankState();} }
    function save(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }catch{} }

    let state=load();

    // Ensure we reset week boards when a new week begins, but keep Future Tasks intact
    (function enforceWeek(){
      const currentKey=weekKeyFor(new Date());
      const storedKey=state.__weekKey;
      if(storedKey!==currentKey){
        const future=(state && Array.isArray(state[FUTURE]))? state[FUTURE] : [];
        state=blankState();
        state.__weekKey=currentKey;
        state[FUTURE]=future; // preserve
        save();
      }
    })();

    /** DOM builders **/
    function buildDayOptions(){ const sel=$('#taskDay'); sel.innerHTML=""; for(const d of DAYS) sel.append(new Option(d,d)); sel.append(new Option(FUTURE,FUTURE)); sel.value=DAYS[new Date().getDay()]; }
    function buildColumns(){ const wrap=$('#columns'); wrap.innerHTML=""; const today=new Date().getDay(); for(const [i,d] of DAYS.entries()) wrap.append(column(d,i===today)); const fwrap=$('#futureRow'); fwrap.innerHTML=""; fwrap.append(column(FUTURE,false)); }
    function column(day,isToday){ const c=document.createElement('div'); c.className='column'+(isToday?' today':''); c.dataset.day=day; const h=document.createElement('div'); h.className='col-head'; const h3=document.createElement('h3'); h3.textContent=day; h.append(h3); const b=document.createElement('span'); b.className='badge'; b.dataset.badgeFor=day; b.textContent='0'; h.append(b); const l=document.createElement('ul'); l.className='list'; l.dataset.day=day; enableDrops(l); c.append(h,l); return c; }

    /** Rendering **/
    function renderDay(day){ const l=document.querySelector(`.list[data-day="${CSS.escape(day)}"]`); if(!l) return; l.innerHTML=''; const tasks=state[day]||[]; for(const t of tasks) l.append(taskItem(t,day)); const b=document.querySelector(`.badge[data-badge-for="${CSS.escape(day)}"]`); if(b) b.textContent=tasks.length; }
    function renderAll(){ for(const d of [...DAYS,FUTURE]) renderDay(d); }

    function taskItem(task,day){ const li=document.createElement('li'); li.className='task'+(task.done?' done':''); li.draggable=true; li.dataset.id=task.id; li.dataset.day=day;
      li.addEventListener('dragstart',ev=>{ li.classList.add('dragging'); try{ev.dataTransfer.effectAllowed='move';}catch{} ev.dataTransfer.setData('text/plain', JSON.stringify({from:day,id:task.id})); });
      li.addEventListener('dragend',()=> li.classList.remove('dragging'));
      const chk=document.createElement('button'); chk.className='icon-btn success'; chk.textContent='âœ“'; chk.title='Toggle done'; chk.addEventListener('click',()=>{ task.done=!task.done; save(); renderDay(day); });
      const txt=document.createElement('div'); txt.className='title'; txt.textContent=task.text; txt.title=task.text;
      const del=document.createElement('button'); del.className='icon-btn danger'; del.textContent='ðŸ—‘'; del.title='Delete task'; del.addEventListener('click',()=>{ state[day]=state[day].filter(t=>t.id!==task.id); save(); renderDay(day); });
      li.append(chk,txt,del); return li; }

    /** DnD **/
    function enableDrops(l){ l.addEventListener('dragover',ev=>{ ev.preventDefault(); l.classList.add('drag-over'); }); l.addEventListener('dragleave',()=> l.classList.remove('drag-over')); l.addEventListener('drop',ev=>{ ev.preventDefault(); l.classList.remove('drag-over'); try{ const p=JSON.parse(ev.dataTransfer.getData('text/plain')); moveTask(p.from,l.dataset.day,p.id); }catch{} }); }
    function moveTask(from,to,id){ if(!state[from]) return; const i=state[from].findIndex(t=>t.id===id); if(i===-1) return; const [task]=state[from].splice(i,1); state[to].push(task); save(); renderDay(from); renderDay(to); }

    /** Add task **/
    function onAdd(){ const text=$('#taskText').value.trim(); const day=$('#taskDay').value; if(!text) return; const t={id:uid(), text, done:false}; state[day].push(t); save(); $('#taskText').value=''; renderDay(day); }

    /** Theme **/
    function applyTheme(theme){ document.documentElement.setAttribute('data-theme',theme); const t=$('#themeToggle'); if(t) t.checked=(theme==='light'); try{ localStorage.setItem(THEME_KEY, theme);}catch{} }
    function initTheme(){ let theme='dark'; try{ theme=localStorage.getItem(THEME_KEY)||'dark'; }catch{} applyTheme(theme); const t=$('#themeToggle'); t.addEventListener('change',()=> applyTheme(t.checked?'light':'dark')); }

    function init(){ renderHeader(); buildDayOptions(); buildColumns(); renderAll(); initTheme(); $('#addBtn').addEventListener('click', onAdd); $('#taskText').addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); onAdd(); } }); }
    init();
  })();
  </script>
</body>
</html>
